!function r(o,c,s){function l(t,e){if(!c[t]){if(!o[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(u)return u(t,!0);var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}var a=c[t]={exports:{}};o[t][0].call(a.exports,function(e){return l(o[t][1][e]||e)},a,a.exports,r,o,c,s)}return c[t].exports}for(var u="function"==typeof require&&require,e=0;e<s.length;e++)l(s[e]);return l}({1:[function(e,t,n){"use strict";!function(){if(cc&&cc.internal&&cc.internal.EditBox){var n=cc.internal.EditBox,e=cc.js,i=n.KeyboardReturnType,a=null,r=null;e.extend(t,n._EditBoxImpl),n._EditBoxImpl=t,Object.assign(t.prototype,{init:function(e){e?this._delegate=e:cc.error("EditBox init failed")},beginEditing:function(){var t=this;this._editing||this._ensureKeyboardHide(function(){var e=t._delegate;t._showKeyboard(),t._registerKeyboardEvent(),t._editing=!0,r=t,e._editBoxEditingDidBegan()})},endEditing:function(){this._hideKeyboard();var e=this._eventListeners;e.onKeyboardComplete&&e.onKeyboardComplete()},_registerKeyboardEvent:function(){var n=this,i=this._delegate,e=this._eventListeners;e.onKeyboardInput=function(e){i._string!==e.value&&i._editBoxTextChanged(e.value)},e.onKeyboardConfirm=function(e){i._editBoxEditingReturn();var t=n._eventListeners;t.onKeyboardComplete&&t.onKeyboardComplete()},e.onKeyboardComplete=function(){n._editing=!1,r=null,n._unregisterKeyboardEvent(),i._editBoxEditingDidEnded()},ral.onKeyboardInput(e.onKeyboardInput),ral.onKeyboardConfirm(e.onKeyboardConfirm),ral.onKeyboardComplete(e.onKeyboardComplete)},_unregisterKeyboardEvent:function(){var e=this._eventListeners;e.onKeyboardInput&&(ral.offKeyboardInput(e.onKeyboardInput),e.onKeyboardInput=null),e.onKeyboardConfirm&&(ral.offKeyboardConfirm(e.onKeyboardConfirm),e.onKeyboardConfirm=null),e.onKeyboardComplete&&(ral.offKeyboardComplete(e.onKeyboardComplete),e.onKeyboardComplete=null)},_otherEditing:function(){return!!r&&r!==this&&r._editing},_ensureKeyboardHide:function(e){var t=this._otherEditing();if(!t&&!a)return e();a&&clearTimeout(a),t&&r.endEditing(),a=setTimeout(function(){a=null,e()},600)},_showKeyboard:function(){var e=this._delegate,t=e.inputMode===n.InputMode.ANY;ral.showKeyboard({defaultValue:e.string,maxLength:e.maxLength<0?65535:e.maxLength,multiple:t,confirmHold:!1,confirmType:function(e){switch(e){case i.DEFAULT:case i.DONE:return"done";case i.SEND:return"send";case i.SEARCH:return"search";case i.GO:return"go";case i.NEXT:return"next"}return"done"}(e.returnType),success:function(e){},fail:function(e){cc.warn(e.errMsg)}})},_hideKeyboard:function(){ral.hideKeyboard({success:function(e){},fail:function(e){cc.warn(e.errMsg)}})}})}function t(){this._delegate=null,this._editing=!1,this._eventListeners={onKeyboardInput:null,onKeyboardConfirm:null,onKeyboardComplete:null}}}()},{}],2:[function(l,e,t){"use strict";var u=l("./cache-manager"),n=l("./fs-utils"),f=n.downloadFile,a=n.readText,r=n.readArrayBuffer,i=n.readJson,d=n.loadSubpackage,h=n.getUserDataPath,p=n._subpackagesPath;cc.assetManager.fsUtils=ral.fsUtils;var m=/^https?:\/\/.*/,g=cc.assetManager.downloader,o=cc.assetManager.parser,c=cc.assetManager.presets;g.maxConcurrency=8,g.maxRequestsPerFrame=64,c.scene.maxConcurrency=10,c.scene.maxRequestsPerFrame=64;var v={},y={};function s(e,t,n){if(m.test(e))n&&n(new Error("Can not load remote scripts"));else{if(y[e])return n&&n();l(e),y[e]=!0,n&&n(null)}}function _(n,e,i){cc.AudioPlayer.load(n).then(function(e){var t={player:e,url:n,duration:e.duration,type:e.type};i(null,t)}).catch(function(e){i(e)})}function b(i,t,a,e,r){var n=R(i,a);n.inLocal?t(n.url,a,r):n.inCache?(u.updateLastTime(i),t(n.url,a,function(e,t){e&&u.removeCache(i),r(e,t)})):f(i,null,a.header,e,function(e,n){e?r(e,null):t(n,a,function(e,t){e||(u.tempFiles.add(i,n),u.cacheFile(i,n,a.cacheEnabled,a.__cacheBundleRoot__,!0)),r(e,t)})})}function w(e,t,n){r(e,n)}function F(e,t,n){a(e,n)}function P(e,t,n){i(e,n)}function E(e,t,n){b(e,P,t,t.onFileProgress,n)}function C(e,t,n){var i=function(e){var t=e.lastIndexOf(".ttf");-1===t&&(t=e.lastIndexOf(".tmp"));if(-1===t)return e;var n,i=e.lastIndexOf("/");n=-1===i?e.substring(0,t)+"_LABEL":e.substring(i+1,t)+"_LABEL";return n}(e),a=new FontFace(i,"url('"+e+"')");document.fonts.add(a),a.load(),a.loaded.then(function(){n(null,i)},function(){cc.warnID(4933,i),n(null,i)})}function x(e,t,n){n(null,e)}function T(e,t,n){b(e,x,t,t.onFileProgress,n)}function S(e,t,n){b(e,w,t,t.onFileProgress,n)}function k(e,n,i){r(e,function(e,t){if(e)return i(e);j(t,n,i)})}function O(e,n,i){r(e,function(e,t){if(e)return i(e);K(t,n,i)})}function M(e,n,i){r(e,function(e,t){if(e)return i(e);I(t,n,i)})}function D(e,n,i){a(e,function(e,t){if(e)return i(e);B(t,n,i)})}var j=o.parsePVRTex,K=o.parsePKMTex,I=o.parseASTCTex,B=o.parsePlist;g.downloadScript=s,o.parsePVRTex=k,o.parsePKMTex=O,o.parseASTCTex=M,o.parsePlist=D,g.register({".js":s,".mp3":T,".ogg":T,".wav":T,".m4a":T,".png":T,".jpg":T,".bmp":T,".jpeg":T,".gif":T,".ico":T,".tiff":T,".image":T,".webp":T,".pvr":T,".pkm":T,".astc":T,".font":T,".eot":T,".ttf":T,".woff":T,".svg":T,".ttc":T,".txt":T,".xml":T,".vsh":T,".fsh":T,".atlas":T,".tmx":T,".tsx":T,".plist":T,".fnt":T,".json":E,".ExportJson":T,".ccon":function(a,e,i){E(a,e,function(e,t){if(e)i(e);else{var n=cc.internal.parseCCONJson(t);Promise.all(n.chunks.map(function(e){return new Promise(function(n,i){S("".concat(cc.path.mainFileName(a)).concat(e),{},function(e,t){e?i(e):n(new Uint8Array(t))})})})).then(function(e){var t=new cc.internal.CCON(n.document,e);i(null,t)}).catch(function(e){i(e)})}})},".cconb":function(e,t,i){S(e,t,function(e,t){if(e)i(e);else try{var n=cc.internal.decodeCCONBinary(new Uint8Array(t));i(null,n)}catch(e){i(e)}})},".binary":T,".bin":T,".dbbin":T,".skel":T,".mp4":T,".avi":T,".mov":T,".mpg":T,".mpeg":T,".rm":T,".rmvb":T,bundle:function(e,i,a){var n=cc.path.basename(e),t=i.version||cc.assetManager.downloader.bundleVers[n],r=t?t+".":"";if(v[n]){var o="".concat(p).concat(n,"/config.").concat(r,"json");d(n,i.onFileProgress,function(e){e?a(e,null):E(o,i,function(e,t){t&&(t.base="".concat(p).concat(n,"/")),a(e,t)})})}else{var c,s;m.test(e)||e.startsWith(h())?(s=e,c="src/bundle-scripts/".concat(n,"/index.").concat(r,"js"),u.makeBundleFolder(n)):-1!==g.remoteBundles.indexOf(n)?(s="".concat(g.remoteServerAddress,"remote/").concat(n),c="src/bundle-scripts/".concat(n,"/index.").concat(r,"js"),u.makeBundleFolder(n)):(s="assets/".concat(n),c="assets/".concat(n,"/index.").concat(r,"js")),y[c]||(l(c),y[c]=!0),i.__cacheBundleRoot__=n,E(o="".concat(s,"/config.").concat(r,"json"),i,function(e,n){if(e)a&&a(e);else if(n.isZip){var t=n.zipVersion;!function(n,i,a){var e=u.cachedFiles.get(n);e?(u.updateLastTime(n),a&&a(null,e.url)):m.test(n)?f(n,null,i.header,i.onFileProgress,function(e,t){e?a&&a(e):u.unzipAndCacheBundle(n,t,i.__cacheBundleRoot__,a)}):u.unzipAndCacheBundle(n,n,i.__cacheBundleRoot__,a)}("".concat(s,"/res.").concat(t?t+".":"","zip"),i,function(e,t){e?a&&a(e):(n.base=t+"/res/",a&&a(null,n))})}else n.base=s+"/",a&&a(null,n)})}},default:function(e,t,n){b(e,F,t,t.onFileProgress,n)}}),o.register({".png":g.downloadDomImage,".jpg":g.downloadDomImage,".bmp":g.downloadDomImage,".jpeg":g.downloadDomImage,".gif":g.downloadDomImage,".ico":g.downloadDomImage,".tiff":g.downloadDomImage,".image":g.downloadDomImage,".webp":g.downloadDomImage,".pvr":k,".pkm":O,".astc":M,".font":C,".eot":C,".ttf":C,".woff":C,".svg":C,".ttc":C,".mp3":_,".ogg":_,".wav":_,".m4a":_,".txt":F,".xml":F,".vsh":F,".fsh":F,".atlas":F,".tmx":F,".tsx":F,".fnt":F,".plist":D,".binary":w,".bin":w,".dbbin":w,".skel":w,".ExportJson":P});var R=function(e,t){var n=!1,i=!1;if(e.startsWith(h()))n=!0;else if(m.test(e)){if(!t.reload){var a=u.cachedFiles.get(e);if(a)i=!0,e=a.url;else{var r=u.tempFiles.get(e);r&&(n=!0,e=r)}}}else n=!0;return{url:e,inLocal:n,inCache:i}};cc.assetManager.transformPipeline.append(function(e){for(var t=e.output=e.input,n=0,i=t.length;n<i;n++){var a=t[n],r=a.options;if(a.config)r.__cacheBundleRoot__=a.config.name;else{if("bundle"===a.ext)continue;r.cacheEnabled=void 0!==r.cacheEnabled&&r.cacheEnabled}".cconb"===a.ext?a.url=a.url.replace(a.ext,".bin"):".ccon"===a.ext&&(a.url=a.url.replace(a.ext,".json"))}});var U=cc.assetManager.init;cc.assetManager.init=function(e){U.call(cc.assetManager,e);var t=cc.settings.querySettings("assets","subpackages");t&&t.forEach(function(e){return v[e]="".concat(p)+e}),u.init()}},{"./cache-manager":3,"./fs-utils":5}],3:[function(e,t,n){"use strict";var i=e("./fs-utils"),a=i.getUserDataPath,r=i.readJsonSync,c=i.makeDirSync,o=i.writeFileSync,u=i.copyFile,f=i.downloadFile,s=i.deleteFile,l=i.rmdirSync,d=i.unzip,h=i.isOutOfStorage,p=!1,m=null,g=!1,v=0,y=/^https?:\/\/.*/,_={cacheDir:"gamecaches",cachedFileName:"cacheList.json",cacheEnabled:!0,autoClear:!0,cacheInterval:500,deleteInterval:500,writeFileInterval:2e3,outOfStorage:!1,tempFiles:null,cachedFiles:null,cacheQueue:{},version:"1.0",getCache:function(e){return this.cachedFiles.has(e)?this.cachedFiles.get(e).url:""},getTemp:function(e){return this.tempFiles.has(e)?this.tempFiles.get(e):""},init:function(){this.cacheDir=a()+"/"+this.cacheDir;var e=this.cacheDir+"/"+this.cachedFileName,t=r(e);t instanceof Error||!t.version?(t instanceof Error||l(this.cacheDir,!0),this.cachedFiles=new cc.AssetManager.Cache,c(this.cacheDir,!0),o(e,JSON.stringify({files:this.cachedFiles._map,version:this.version}),"utf8")):this.cachedFiles=new cc.AssetManager.Cache(t.files),this.tempFiles=new cc.AssetManager.Cache},updateLastTime:function(e){this.cachedFiles.has(e)&&(this.cachedFiles.get(e).lastTime=Date.now())},_write:function(){m=null,o(this.cacheDir+"/"+this.cachedFileName,JSON.stringify({files:this.cachedFiles._map,version:this.version}),"utf8")},writeCacheFile:function(){m=m||setTimeout(this._write.bind(this),this.writeFileInterval)},_cache:function(){p=!1;var t=this,n="";for(var e in this.cacheQueue){n=e;break}if(n){var i=this.cacheQueue[n],a=i.srcUrl,r=i.isCopy,o=i.cacheBundleRoot,c=Date.now().toString(),s="";s=o?"".concat(this.cacheDir,"/").concat(o,"/").concat(c).concat(v++).concat(cc.path.extname(n)):"".concat(this.cacheDir,"/").concat(c).concat(v++).concat(cc.path.extname(n)),r?u(a,s,l):f(a,s,null,l)}function l(e){if(e){if(h(e.message))return t.outOfStorage=!0,void(t.autoClear&&t.clearLRU())}else t.cachedFiles.add(n,{bundle:o,url:s,lastTime:c}),t.writeCacheFile();delete t.cacheQueue[n],cc.js.isEmptyObject(t.cacheQueue)||p||(p=!0,setTimeout(t._cache.bind(t),t.cacheInterval))}},cacheFile:function(e,t,n,i,a){!(n=void 0!==n?n:this.cacheEnabled)||this.cacheQueue[e]||this.cachedFiles.has(e)||(this.cacheQueue[e]={srcUrl:t,cacheBundleRoot:i,isCopy:a},p||this.outOfStorage||(p=!0,setTimeout(this._cache.bind(this),this.cacheInterval)))},clearCache:function(){var t=this;l(this.cacheDir,!0),this.cachedFiles=new cc.AssetManager.Cache,c(this.cacheDir,!0),this.outOfStorage=!1,clearTimeout(m),this._write(),cc.assetManager.bundles.forEach(function(e){y.test(e.base)&&t.makeBundleFolder(e.name)})},clearLRU:function(){if(!g){g=!0;var n=[],i=this;if(this.cachedFiles.forEach(function(t,e){i._isZipFile(e)&&cc.assetManager.bundles.find(function(e){return-1!==e.base.indexOf(t.url)})||n.push({originUrl:e,url:t.url,lastTime:t.lastTime})}),n.sort(function(e,t){return e.lastTime-t.lastTime}),n.length=Math.floor(n.length/3),0!==n.length){for(var e=0,t=n.length;e<t;e++)this.cachedFiles.remove(n[e].originUrl);clearTimeout(m),this._write(),setTimeout(function e(){var t=n.pop();i._isZipFile(t.originUrl)?(l(t.url,!0),i._deleteFileCB()):s(t.url,i._deleteFileCB.bind(i)),0<n.length?setTimeout(e,i.deleteInterval):g=!1},i.deleteInterval)}}},removeCache:function(e){if(this.cachedFiles.has(e)){var t=this.cachedFiles.remove(e).url;clearTimeout(m),this._write(),this._isZipFile(e)?(l(t,!0),this._deleteFileCB()):s(t,this._deleteFileCB.bind(this))}},_deleteFileCB:function(e){e||(this.outOfStorage=!1)},makeBundleFolder:function(e){c(this.cacheDir+"/"+e,!0)},unzipAndCacheBundle:function(t,e,n,i){var a=Date.now().toString(),r="".concat(this.cacheDir,"/").concat(n,"/").concat(a).concat(v++),o=this;c(r,!0),d(e,r,function(e){if(e)return l(r,!0),h(e.message)&&(o.outOfStorage=!0,o.autoClear&&o.clearLRU()),void(i&&i(e));o.cachedFiles.add(t,{bundle:n,url:r,lastTime:a}),o.writeCacheFile(),i&&i(null,r)})},_isZipFile:function(e){return".zip"===e.slice(-4)}};cc.assetManager.cacheManager=t.exports=_},{"./fs-utils":5}],4:[function(e,t,n){"use strict";var i=ral.createCanvas.bind(ral);ral.createCanvas=function(){var e=i();return e.style={},e}},{}],5:[function(e,t,n){"use strict";var a=ral.getFileSystemManager?ral.getFileSystemManager():null,i=/the maximum size of the file storage/,c={fs:a,_subpackagesPath:"usr_",isOutOfStorage:function(e){return i.test(e)},getUserDataPath:function(){return ral.env.USER_DATA_PATH},checkFsValid:function(){return!!a||(console.warn("can not get the file system!"),!1)},deleteFile:function(t,n){a.unlink({filePath:t,success:function(){n&&n(null)},fail:function(e){console.warn("Delete file failed: path: ".concat(t," message: ").concat(e.errMsg)),n&&n(new Error(e.errMsg))}})},downloadFile:function(t,e,n,i,a){var r={url:t,success:function(e){200===e.statusCode?a&&a(null,e.tempFilePath||e.filePath):(e.filePath&&c.deleteFile(e.filePath),console.warn("Download file failed: path: ".concat(t," message: ").concat(e.statusCode)),a&&a(new Error(e.statusCode),null))},fail:function(e){console.warn("Download file failed: path: ".concat(t," message: ").concat(e.errMsg)),a&&a(new Error(e.errMsg),null)}};e&&(r.filePath=e),n&&(r.header=n);var o=ral.downloadFile(r);i&&o.onProgressUpdate(i)},saveFile:function(t,e,n){ral.saveFile({tempFilePath:t,filePath:e,success:function(e){n&&n(null)},fail:function(e){console.warn("Save file failed: path: ".concat(t," message: ").concat(e.errMsg)),n&&n(new Error(e.errMsg))}})},copyFile:function(t,e,n){a.copyFile({srcPath:t,destPath:e,success:function(){n&&n(null)},fail:function(e){console.warn("Copy file failed: path: ".concat(t," message: ").concat(e.errMsg)),n&&n(new Error(e.errMsg))}})},writeFile:function(t,e,n,i){a.writeFile({filePath:t,encoding:n,data:e,success:function(){i&&i(null)},fail:function(e){console.warn("Write file failed: path: ".concat(t," message: ").concat(e.errMsg)),i&&i(new Error(e.errMsg))}})},writeFileSync:function(t,e,n){try{return a.writeFileSync(t,e,n),null}catch(e){return console.warn("Write file failed: path: ".concat(t," message: ").concat(e.message)),new Error(e.message)}},readFile:function(t,e,n){a.readFile({filePath:t,encoding:e,success:function(e){n&&n(null,e.data)},fail:function(e){console.warn("Read file failed: path: ".concat(t," message: ").concat(e.errMsg)),n&&n(new Error(e.errMsg),null)}})},readDir:function(t,n){a.readdir({dirPath:t,success:function(e){n&&n(null,e.files)},fail:function(e){console.warn("Read directory failed: path: ".concat(t," message: ").concat(e.errMsg)),n&&n(new Error(e.errMsg),null)}})},readText:function(e,t){c.readFile(e,"utf8",t)},readArrayBuffer:function(e,t){c.readFile(e,"binary",t)},readJson:function(i,a){c.readFile(i,"utf8",function(t,e){var n=null;if(!t)try{n=JSON.parse(e)}catch(e){console.warn("Read json failed: path: ".concat(i," message: ").concat(e.message)),t=new Error(e.message)}a&&a(t,n)})},readJsonSync:function(t){try{var e=a.readFileSync(t,"utf8");return JSON.parse(e)}catch(e){return console.warn("Read json failed: path: ".concat(t," message: ").concat(e.message)),new Error(e.message)}},makeDirSync:function(t,e){try{return a.mkdirSync(t,e),null}catch(e){return console.warn("Make directory failed: path: ".concat(t," message: ").concat(e.message)),new Error(e.message)}},rmdirSync:function(t,e){try{a.rmdirSync(t,e)}catch(e){return console.warn("rm directory failed: path: ".concat(t," message: ").concat(e.message)),new Error(e.message)}},exists:function(e,t){a.access({path:e,success:function(){t&&t(!0)},fail:function(){t&&t(!1)}})},loadSubpackage:function(t,e,n){var i=ral.loadSubpackage({name:"".concat(c._subpackagesPath).concat(t),success:function(){n&&n()},fail:function(e){console.warn("Load Subpackage failed: path: ".concat(t," message: ").concat(e.errMsg)),n&&n(new Error("Failed to load subpackage ".concat(t,": ").concat(e.errMsg)))}});return e&&i.onProgressUpdate(e),i},unzip:function(t,e,n){a.unzip({zipFilePath:t,targetPath:e,success:function(){n&&n(null)},fail:function(e){console.warn("unzip failed: path: ".concat(t," message: ").concat(e.errMsg)),n&&n(new Error("unzip failed: "+e.errMsg))}})}};window.fsUtils=t.exports=c},{}],6:[function(e,t,n){"use strict";cc.game.restart=function(){},ral.onWindowResize&&ral.onWindowResize(function(e,t){cc.game.canvas&&cc.view.setCanvasSize(e,t)})},{}],7:[function(e,t,n){"use strict";e("./fs-utils"),e("./canvas"),e("./asset-manager.js"),e("./EditBox.js"),e("./game.js")},{"./EditBox.js":1,"./asset-manager.js":2,"./canvas":4,"./fs-utils":5,"./game.js":6}],8:[function(e,t,n){"use strict";function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}if(cc.internal.VideoPlayer){var u=cc.internal.VideoPlayer.EventType,f=cc.Vec3,d=cc.mat4(),h=new f,p=new f,m=ral.getSystemInfoSync().pixelRatio;cc.internal.VideoPlayerImplManager.getImpl=function(e){return new g(e)};var g=function(){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),c(this,s(t).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,cc.internal.VideoPlayerImpl),function(e,t,n){t&&o(e.prototype,t),n&&o(e,n)}(t,[{key:"syncClip",value:function(e){this.removeVideoPlayer(),e&&this.createVideoPlayer(e._nativeAsset)}},{key:"syncURL",value:function(e){this.removeVideoPlayer(),e&&this.createVideoPlayer(e)}},{key:"onCanplay",value:function(){this._loaded||(this._loaded=!0,this.setVisible(this._visible),this.dispatchEvent(u.READY_TO_PLAY),this.delayedPlay())}},{key:"_bindEvent",value:function(){var e=this._video,t=this;e&&(e.onPlay(function(){t._video===e&&(t._playing=!0,t.dispatchEvent(u.PLAYING))}),e.onEnded(function(){t._video===e&&(t._playing=!1,t._currentTime=t._duration,t.dispatchEvent(u.COMPLETED))}),e.onPause(function(){t._video===e&&(t._playing=!1,t.dispatchEvent(u.PAUSED))}),e.onTimeUpdate(function(e){t._duration=e.duration,t._currentTime=e.position}))}},{key:"_unbindEvent",value:function(){var e=this._video;e&&(e.offPlay(),e.offEnded(),e.offPause(),e.offTimeUpdate())}},{key:"createVideoPlayer",value:function(e){if(ral.createVideo){if(!this._video){var t=this._getInitRect();this._video=ral.createVideo(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach(function(e){r(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},t,{src:e,objectFit:"contain",live:!1,showCenterPlayBtn:!1,controls:!1})),this._duration=0,this._currentTime=0,this._loaded=!1,this.setVisible(this._visible),this._bindEvent(),this._forceUpdate=!0}this.setURL(e),this._forceUpdate=!0}else console.warn("VideoPlayer not supported")}},{key:"setURL",value:function(e){var t=this._video;if(t&&t.src!==e){t.stop(),this._unbindEvent(),t.src=e,t.muted=!0;var n=this;this._loaded=!1;var i=function(e){var t=JSON.parse(e.position);if("object"===a(t))return n._duration=t.duration,void(n._currentTime=t.position);n._duration=e.duration,n._currentTime=e.position};t.onPlay(function e(){t.offPlay(e),t.offTimeUpdate(i),n.enable(),n._bindEvent(),t.stop(),t.muted=!1,n._loaded=!0,n._playing=!1,n._currentTime=0,n.dispatchEvent(u.READY_TO_PLAY)}),t.onTimeUpdate(i),t.play()}}},{key:"removeVideoPlayer",value:function(){var e=this.video;e&&(e.stop(),e.destroy(),this._playing=!1,this._loaded=!1,this._loadedMeta=!1,this._ignorePause=!1,this._cachedCurrentTime=0,this._video=null)}},{key:"setVisible",value:function(e){var t=this._video;t&&this._visible!==e&&(t.width=e&&this._actualWidth||0,this._visible=e)}},{key:"getDuration",value:function(){return this.duration()}},{key:"duration",value:function(){return this._duration}},{key:"syncPlaybackRate",value:function(e){var t=this._video;t&&e!==t.playbackRate&&(.5===e|.8===e|1===e|1.25===e|1.5===e?t.playbackRate=e:console.warn("The platform does not support this PlaybackRate!"))}},{key:"syncVolume",value:function(){console.warn("The platform does not support")}},{key:"syncMute",value:function(e){var t=this._video;t&&t.muted!==e&&(t.muted=e)}},{key:"syncLoop",value:function(e){var t=this._video;t&&t.loop!==e&&(t.loop=e)}},{key:"syncStayOnBottom",value:function(){console.warn("The platform does not support")}},{key:"getCurrentTime",value:function(){return this.video?this.currentTime():-1}},{key:"currentTime",value:function(){return this._currentTime}},{key:"seekTo",value:function(e){var t=this._video;t&&this._loaded&&t.seek(e)}},{key:"disable",value:function(e){this._video&&(e||this._video.pause(),this.setVisible(!1),this._visible=!1)}},{key:"enable",value:function(){this._video&&(this.setVisible(!0),this._visible=!0)}},{key:"canPlay",value:function(){this._video.play(),this.syncCurrentTime()}},{key:"resume",value:function(){var e=this._video;!this._playing&&e&&e.play()}},{key:"pause",value:function(){var e=this._video;this._playing&&e&&e.pause()}},{key:"stop",value:function(){var t=this,e=this._video;e&&this._visible&&e.stop().then(function(e){!e.errMsg||e.errMsg.includes("ok")?(t._currentTime=0,t._playing=!1,t.dispatchEvent(u.STOPPED)):console.error("failed to stop video player")})}},{key:"canFullScreen",value:function(e){this._video&&this.setFullScreenEnabled(e)}},{key:"setFullScreenEnabled",value:function(e){var t=this._video;t&&this._fullScreenEnabled!==e&&(e?t.requestFullScreen():t.exitFullScreen(),this._fullScreenEnabled=e)}},{key:"syncKeepAspectRatio",value:function(e){console.warn("On wechat game videoPlayer is always keep the aspect ratio")}},{key:"syncMatrix",value:function(){}},{key:"_getInitRect",value:function(){if(this._component&&this._uiTrans){var e=this.UICamera;if(e){this._component.node.getWorldMatrix(d);var t=this._uiTrans.contentSize.width,n=this._uiTrans.contentSize.height;this._m00=d.m00,this._m01=d.m01,this._m04=d.m04,this._m05=d.m05,this._m12=d.m12,this._m13=d.m13,this._w=t,this._h=n;cc.game.canvas.width;var i=cc.game.canvas.height,a=this._uiTrans.anchorPoint;f.set(h,-a.x*this._w,(1-a.y)*this._h,0),f.set(p,(1-a.x)*this._w,-a.y*this._h,0),f.transformMat4(h,h,d),f.transformMat4(p,p,d),e.worldToScreen(h,h),e.worldToScreen(p,p);var r=p.x-h.x,o=h.y-p.y;return{x:h.x/m,y:(i-h.y)/m,width:r/m,height:o/m}}}}}]),t}()}},{}],9:[function(e,t,n){"use strict";e("../../../common/engine/index"),e("./VideoPlayer")},{"../../../common/engine/index":7,"./VideoPlayer":8}]},{},[9]);